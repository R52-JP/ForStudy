<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>For Study フォア・スタディー（福江プリント集）</title>
  <style>
    h1 {
        border-bottom: double 5px #FFC778;
    }

    h2 {
        font-family: "Hiragino Maru Gothic ProN W4";
        font-size: 175%;
    }

    a {
      font-size: 110%;
    }
    
    .mark {
        line-height: 0.5;
        font-family: "Hiragino Maru Gothic ProN W4";
        font-size: 110%;
    }
    
    .buttons > a {
        font-family: "Hiragino Maru Gothic ProN W4";
        font-size: 125%
    }

    .buttons > a > mark {
        background-color: #cecece;
    }
  </style>
</head>
<body>
  <h1>For Study フォア・スタディー（福江プリント集）</h1>
  <h2>日本国憲法の穴埋め</h2>
  <div class="buttons">
    <a><mark onclick="hide_all()">（すべて隠す）</mark></a><a>　　　</a><a><mark onclick="show_all()">（すべて表示）</mark></a><br><br>
  </div>
  <div id="main_element"></div>
  <p id="data_text"></p>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <script language="javascript" type="text/javascript">
    // 左角カッコを</a><a><mark id="~">に置換する関数
    let replace_text_L = (text, number, index=1) => {
        let replace_result = "</a><a class=\"mark\"><mark id=\"" + number + "\">"
        return text.replace(/\[/g, function(match) { if (--index == 0) return replace_result; else return match; });
    };

    // 右角カッコを</a></mark>に置換する関数
    let replace_text_R = (text, index=1) => {
        let replace_result = "</mark></a><a>"
        return text.replace(/\]/g, function(match) { if (--index == 0) return replace_result; else return match; });
    };

    // 置換する文字列

    url = "text.txt"
    let count_blank;
    $.get(url,(data) => {
        let result = data;
        result = result.replaceAll("  ", "　")

        // はじめと末尾にそれぞれ「<a>」と「</a><br>」をつける
        result = "<a>" + result + "</a><br>";

        // 改行で区切るために，改行（\n）を「</a><br><a>」に置換
        result = result.replaceAll("\n","</a><br><a>");

        // 左角カッコと右角カッコがそれぞれ何個あるか。
        // (左角カッコの数)＝(右角カッコの数)となるはずだが一応どっちともカウントしておく。
        count_blank = (result.match(/\[/g) || []).length;

        // 左角カッコをそれぞれ置換
        for (let i = 1; i <= count_blank; i++) {
            result = result.replace("[","</a><a class=\"mark\"><mark id=\"" + i + "\">");
        };

        // 右角カッコをそれぞれ置換
        result = result.replaceAll("]", "</mark></a><a>");

        // 結果を表示
        console.log(result);


        // htmlのmain_element要素に挿入
        let element = document.getElementById('main_element');
        element.insertAdjacentHTML('afterbegin', result);
        bind();
    });

    // 空欄の中身を隠すか表示するかを切り替える関数
    let change_color = (id) => {
        let a = document.getElementById(id);
        if (a.style.color == "black") { 
            a.style.color = "yellow";
        }
        else {
            a.style.color = "black";
        };
    };

    // 空欄の中身をすべて隠す関数
    let hide_all = () => {
        for (let i=1; i<=count_blank; i++) {
            let a = document.getElementById(String(i));
            a.style.color = "yellow";
        }
    }

    // 空欄の中身をすべて表示する関数
    let show_all = () => {
        for (let i=1; i<=count_blank; i++) {
            let a = document.getElementById(String(i));
            a.style.color = "black";
        };
    };

    // 空欄のon_clickイベントとchange_color()関数を結びつける関数
    let bind = () => {
        for (let i=1; i<=count_blank; i++) {
            let a = document.getElementById(String(i));
            let clickevent = "change_color(\"" + String(i) + "\")";
            a.setAttribute("onclick", clickevent);
        };
        show_all()
    };

    // bind()関数を実行
    bind()

  </script>
</body>
</html>
